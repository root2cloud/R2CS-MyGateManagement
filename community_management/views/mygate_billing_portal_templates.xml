<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_dashboard" name="Customer Dashboard">
        <t t-call="portal.portal_layout">
            <t t-set="title">My Dashboard</t>

            <style>
                /* Dashboard Styling */
                .dashboard-container {
                background-color: #f5f7fa;
                min-height: 100vh;
                padding: 20px 0;
                }

                .container {
                max-width: 1200px;
                margin: 0 auto;
                }

                /* Welcome Header */
                .welcome-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 10px;
                padding: 25px;
                margin-bottom: 25px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                }

                .welcome-title {
                font-size: 28px;
                font-weight: 600;
                margin-bottom: 5px;
                }

                .welcome-subtitle {
                opacity: 0.9;
                font-size: 16px;
                }

                /* Stat Cards */
                .stat-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 25px;
                }

                .stat-card {
                background: white;
                border-radius: 10px;
                padding: 20px;
                text-align: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                transition: transform 0.3s ease;
                }

                .stat-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                }

                .stat-icon {
                font-size: 30px;
                margin-bottom: 15px;
                color: #667eea;
                }

                .stat-number {
                font-size: 32px;
                font-weight: 700;
                color: #333;
                margin-bottom: 5px;
                }

                .stat-label {
                color: #666;
                font-size: 14px;
                font-weight: 500;
                }

                /* Amount Cards */
                .amount-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 25px;
                }

                .amount-card {
                background: white;
                border-radius: 10px;
                padding: 25px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                }

                .amount-title {
                color: #666;
                font-size: 14px;
                margin-bottom: 10px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                }

                .amount-value {
                font-size: 28px;
                font-weight: 700;
                color: #333;
                }

                .amount-value.total {
                color: #10b981;
                }

                .amount-value.due {
                color: #ef4444;
                }

                .amount-note {
                color: #888;
                font-size: 13px;
                margin-top: 5px;
                }

                /* Filter Tabs */
                .filter-tabs {
                display: flex;
                gap: 10px;
                margin-bottom: 25px;
                flex-wrap: wrap;
                }

                .filter-tab {
                padding: 10px 20px;
                background: white;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                color: #666;
                text-decoration: none;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s ease;
                }

                .filter-tab:hover {
                background: #f3f4f6;
                color: #333;
                text-decoration: none;
                }

                .filter-tab.active {
                background: #667eea;
                color: white;
                border-color: #667eea;
                }

                /* Invoices Table */
                .invoices-table {
                background: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                margin-bottom: 25px;
                }

                .table-header {
                padding: 20px;
                border-bottom: 1px solid #e5e7eb;
                display: flex;
                justify-content: space-between;
                align-items: center;
                }

                .table-title {
                font-size: 18px;
                font-weight: 600;
                color: #333;
                margin: 0;
                }

                .table-body {
                padding: 0;
                }

                table {
                width: 100%;
                border-collapse: collapse;
                }

                th {
                background: #f9fafb;
                padding: 15px 20px;
                text-align: left;
                font-weight: 600;
                color: #666;
                border-bottom: 1px solid #e5e7eb;
                font-size: 13px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                }

                td {
                padding: 15px 20px;
                border-bottom: 1px solid #e5e7eb;
                vertical-align: middle;
                }

                tr:hover {
                background-color: #f9fafb;
                }

                tr:last-child td {
                border-bottom: none;
                }

                /* Status Badges */
                .status-badge {
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                display: inline-block;
                }

                .status-paid {
                background-color: #d1fae5;
                color: #065f46;
                }

                .status-unpaid {
                background-color: #fef3c7;
                color: #92400e;
                }

                .status-partial {
                background-color: #dbeafe;
                color: #1e40af;
                }

                .status-overdue {
                background-color: #fee2e2;
                color: #991b1b;
                }

                /* Buttons */
                .btn {
                padding: 8px 16px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 5px;
                transition: all 0.2s ease;
                border: none;
                cursor: pointer;
                }

                .btn-primary {
                background: #667eea;
                color: white;
                }

                .btn-primary:hover {
                background: #5a6fd8;
                color: white;
                text-decoration: none;
                }

                .btn-success {
                background: #10b981;
                color: white;
                }

                .btn-success:hover {
                background: #0da271;
                color: white;
                text-decoration: none;
                }

                .btn-sm {
                padding: 6px 12px;
                font-size: 13px;
                }

                /* Empty State */
                .empty-state {
                text-align: center;
                padding: 60px 20px;
                }

                .empty-icon {
                font-size: 48px;
                color: #d1d5db;
                margin-bottom: 20px;
                }

                .empty-title {
                color: #666;
                font-size: 18px;
                margin-bottom: 10px;
                }

                .empty-message {
                color: #888;
                font-size: 14px;
                margin-bottom: 20px;
                }

                /* Recent Activity */
                .recent-activity {
                background: white;
                border-radius: 10px;
                padding: 25px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                }

                .activity-title {
                font-size: 18px;
                font-weight: 600;
                color: #333;
                margin-bottom: 20px;
                }

                .activity-item {
                padding: 15px 0;
                border-bottom: 1px solid #e5e7eb;
                }

                .activity-item:last-child {
                border-bottom: none;
                }

                .activity-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
                }

                .activity-info h6 {
                margin: 0 0 5px 0;
                font-size: 14px;
                font-weight: 600;
                }

                .activity-info p {
                margin: 0;
                color: #666;
                font-size: 13px;
                }

                .activity-meta {
                text-align: right;
                }

                .activity-date {
                color: #888;
                font-size: 12px;
                }

                /* Pagination */
                .pagination {
                display: flex;
                justify-content: center;
                gap: 5px;
                padding: 20px;
                border-top: 1px solid #e5e7eb;
                }

                .page-item {
                list-style: none;
                }

                .page-link {
                padding: 8px 16px;
                background: white;
                border: 1px solid #e5e7eb;
                border-radius: 6px;
                color: #666;
                text-decoration: none;
                transition: all 0.2s ease;
                }

                .page-link:hover {
                background: #f3f4f6;
                color: #333;
                }

                .page-item.active .page-link {
                background: #667eea;
                color: white;
                border-color: #667eea;
                }

                /* Responsive */
                @media (max-width: 768px) {
                .container {
                padding: 0 15px;
                }

                .stat-cards,
                .amount-cards {
                grid-template-columns: 1fr;
                }

                .filter-tabs {
                justify-content: center;
                }

                table {
                display: block;
                overflow-x: auto;
                }

                .table-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                }
                }
            </style>

            <!-- Dashboard Content -->
            <div class="dashboard-container">
                <div class="container">
                    <!-- Welcome Header -->
                    <div class="welcome-card">
                        <h1 class="welcome-title">Welcome,<t t-esc="partner.name"/>!
                        </h1>
                        <p class="welcome-subtitle">
                            Here's an overview of your invoices and bills
                        </p>
                        <small>
                            <i class="fa fa-calendar mr-1"></i>
                            <t t-esc="today"/>
                        </small>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="stat-cards">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fa fa-file-invoice"></i>
                            </div>
                            <div class="stat-number">#
                                <t t-esc="invoice_stats['total']"/>
                            </div>
                            <div class="stat-label">Total Invoices</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fa fa-check-circle"></i>
                            </div>
                            <div class="stat-number">#
                                <t t-esc="invoice_stats['paid']"/>
                            </div>
                            <div class="stat-label">Paid</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fa fa-clock"></i>
                            </div>
                            <div class="stat-number">#
                                <t t-esc="invoice_stats['unpaid']"/>
                            </div>
                            <div class="stat-label">Unpaid</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fa fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-number">#
                                <t t-esc="invoice_stats['overdue']"/>
                            </div>
                            <div class="stat-label">Overdue</div>
                        </div>
                    </div>

                    <!-- Amount Summary -->
                    <div class="amount-cards">
                        <div class="amount-card">
                            <div class="amount-title">Total Amount</div>
                            <div class="amount-value total">
                                <t t-esc="'{:,.2f}'.format(total_amount)"/>
                                <t t-if="partner.currency_id">
                                    <t t-esc="partner.currency_id.symbol"/>
                                </t>
                            </div>
                            <div class="amount-note">All posted invoices</div>
                        </div>

                        <div class="amount-card">
                            <div class="amount-title">Due Amount</div>
                            <div class="amount-value due">
                                <t t-esc="'{:,.2f}'.format(due_amount)"/>
                                <t t-if="partner.currency_id">
                                    <t t-esc="partner.currency_id.symbol"/>
                                </t>
                            </div>
                            <div class="amount-note">Requires payment</div>
                        </div>
                    </div>

                    <!-- Filter Tabs -->
                    <div class="filter-tabs">
                        <a href="/my/dashboard"
                           class="filter-tab"
                           t-att-class="'filter-tab ' + ('active' if not filterby else '')">
                            All
                        </a>
                        <!-- Fixed: Changed variable name from filter to filter_item -->
                        <t t-foreach="filter_options.items()" t-as="filter_item">
                            <a t-att-href="'/my/dashboard?filterby=' + filter_item[0]"
                               class="filter-tab"
                               t-att-class="'filter-tab ' + ('active' if filterby == filter_item[0] else '')">
                                <t t-esc="filter_item[1]['label']"/>
                            </a>
                        </t>
                    </div>

                    <!-- Invoices Table -->
                    <div class="invoices-table">
                        <div class="table-header">
                            <h3 class="table-title">Recent Invoices</h3>
                            <div>
                                <a href="/my/invoices" class="btn btn-primary">
                                    <i class="fa fa-eye mr-1"></i>
                                    View All
                                </a>
                            </div>
                        </div>

                        <div class="table-body">
                            <t t-if="invoices">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Invoice #</th>
                                            <th>Date</th>
                                            <th>Due Date</th>
                                            <th>Customer/Vendor</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="invoices" t-as="invoice">
                                            <tr>
                                                <td>
                                                    <strong>
                                                        <a t-att-href="'/my/invoices/%s' % invoice.id"
                                                           class="text-primary" style="color: #667eea;">
                                                            <t t-esc="invoice.name"/>
                                                        </a>
                                                    </strong>
                                                </td>
                                                <td>
                                                    <t t-esc="invoice.invoice_date"/>
                                                </td>
                                                <td>
                                                    <div t-att-class="invoice.invoice_date_due and invoice.invoice_date_due &lt; today and 'text-danger' or ''">
                                                        <t t-esc="invoice.invoice_date_due"/>
                                                        <t t-if="invoice.invoice_date_due and invoice.invoice_date_due &lt; today">
                                                            <br/>
                                                            <small class="text-danger">
                                                                <i class="fa fa-exclamation-circle mr-1"></i>
                                                                Overdue
                                                            </small>
                                                        </t>
                                                    </div>
                                                </td>
                                                <td>
                                                    <t t-esc="invoice.partner_id.name"/>
                                                </td>
                                                <td>
                                                    <strong>
                                                        <t t-esc="'{:,.2f}'.format(invoice.amount_total)"/>
                                                        <t t-if="invoice.currency_id">
                                                            <t t-esc="invoice.currency_id.symbol"/>
                                                        </t>
                                                    </strong>
                                                </td>
                                                <td>
                                                    <t t-if="invoice.payment_state == 'paid'">
                                                        <span class="status-badge status-paid">
                                                            Paid
                                                        </span>
                                                    </t>
                                                    <t t-elif="invoice.payment_state == 'not_paid'">
                                                        <span class="status-badge status-unpaid">
                                                            Unpaid
                                                        </span>
                                                    </t>
                                                    <t t-elif="invoice.payment_state == 'partial'">
                                                        <span class="status-badge status-partial">
                                                            Partial
                                                        </span>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="status-badge">
                                                            <t t-esc="invoice.payment_state"/>
                                                        </span>
                                                    </t>
                                                </td>
                                                <td>
                                                    <div style="display: flex; gap: 8px;">
                                                        <a t-att-href="'/my/invoices/%s' % invoice.id"
                                                           class="btn btn-primary btn-sm">
                                                            <i class="fa fa-eye"></i>
                                                        </a>
                                                        <t t-if="invoice.payment_state in ['not_paid', 'partial']">
                                                            <a class="btn btn-primary"
                                                               t-att-href="'/my/invoices/%s?access_token=%s' % (invoice.id, invoice.access_token)">
                                                                Pay Now
                                                            </a>
                                                        </t>

                                                    </div>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>

                                <!-- Pagination -->
                                <t t-if="invoice_pager and invoice_pager['page_count'] > 1">
                                    <div class="pagination">
                                        <t t-foreach="invoice_pager['pages']" t-as="page">
                                            <li class="page-item"
                                                t-att-class="'active' if page['num'] == invoice_pager['page'] else ''">
                                                <a class="page-link" t-att-href="page['url']">
                                                    <t t-esc="page['num']"/>
                                                </a>
                                            </li>
                                        </t>
                                    </div>
                                </t>
                            </t>
                            <t t-else="">
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fa fa-file-invoice"></i>
                                    </div>
                                    <h4 class="empty-title">No invoices found</h4>
                                    <p class="empty-message">
                                        You don't have any invoices matching your filters.
                                    </p>
                                    <a href="/my/dashboard" class="btn btn-primary">
                                        <i class="fa fa-refresh mr-1"></i>
                                        Clear Filters
                                    </a>
                                </div>
                            </t>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="recent-activity">
                        <h3 class="activity-title">Recent Activity</h3>
                        <t t-if="recent_activity">
                            <div class="activity-list">
                                <t t-foreach="recent_activity" t-as="activity">
                                    <div class="activity-item">
                                        <div class="activity-content">
                                            <div class="activity-info">
                                                <h6>
                                                    <a t-att-href="'/my/invoices/%s' % activity.id"
                                                       style="color: #667eea;">
                                                        <t t-esc="activity.name"/>
                                                    </a>
                                                </h6>
                                                <p>
                                                    <t t-esc="activity.move_type == 'out_invoice' and 'Customer Invoice' or
                                                            activity.move_type == 'in_invoice' and 'Vendor Bill' or
                                                            activity.move_type == 'out_refund' and 'Credit Note' or
                                                            activity.move_type == 'in_refund' and 'Vendor Credit'"/>
                                                    â€¢
                                                    <t t-esc="'{:,.2f}'.format(activity.amount_total)"/>
                                                    <t t-if="activity.currency_id">
                                                        <t t-esc="activity.currency_id.symbol"/>
                                                    </t>
                                                </p>
                                            </div>
                                            <div class="activity-meta">
                                                <t t-if="activity.payment_state == 'paid'">
                                                    <span class="status-badge status-paid">Paid</span>
                                                </t>
                                                <t t-elif="activity.payment_state == 'not_paid'">
                                                    <span class="status-badge status-unpaid">Unpaid</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="status-badge">
                                                        <t t-esc="activity.payment_state"/>
                                                    </span>
                                                </t>
                                                <div class="activity-date">
                                                    <t t-esc="activity.invoice_date"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="empty-state" style="padding: 30px 20px;">
                                <div class="empty-icon">
                                    <i class="fa fa-history"></i>
                                </div>
                                <h4 class="empty-title">No recent activity</h4>
                                <p class="empty-message">
                                    There's no recent activity to display.
                                </p>
                            </div>
                        </t>
                    </div>
                </div>
            </div>

            <!-- Font Awesome -->
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>

            <!-- Simple JavaScript -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                // Add animation to stat cards
                const statCards = document.querySelectorAll('.stat-card');
                statCards.forEach((card, index) => {
                setTimeout(() => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.3s ease';

                setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
                }, 50);
                }, index * 100);
                });

                // Highlight overdue invoices
                document.querySelectorAll('tr').forEach(row => {
                if (row.textContent.includes('Overdue')) {
                row.style.backgroundColor = 'rgba(239, 68, 68, 0.05)';
                }
                });

                // Update page title
                document.title = "Dashboard - " + document.title;
                });
            </script>
        </t>
    </template>
</odoo>