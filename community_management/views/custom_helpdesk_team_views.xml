<!-- views.xml -->
<odoo>
    <data>

        <!-- TAGS -->
        <record id="view_tag_list" model="ir.ui.view">
            <field name="name">custom.helpdesk.tag.list</field>
            <field name="model">custom.helpdesk.tag</field>
            <field name="arch" type="xml">
                <list>
                    <field name="name"/>
                    <field name="color" widget="color_picker"/>
                </list>
            </field>
        </record>

        <record id="view_tag_form" model="ir.ui.view">
            <field name="name">custom.helpdesk.tag.form</field>
            <field name="model">custom.helpdesk.tag</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="color" widget="color_picker"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- TICKET VIEWS -->
        <record id="view_ticket_list" model="ir.ui.view">
            <field name="name">custom.helpdesk.ticket.list</field>
            <field name="model">custom.helpdesk.ticket</field>
            <field name="arch" type="xml">
                <list decoration-success="stage == 'done'"
                      decoration-info="stage in ('new','open')"
                      decoration-warning="stage == 'pending'">
                    <field name="name"/>
                    <field name="team_id"/>
                    <field name="tenant_id"/>
                    <field name="assigned_to"/>
                    <field name="priority" widget="priority"/>
                    <field name="stage"/>
                    <field name="date_open"/>
                    <field name="date_close"/>
                </list>
            </field>
        </record>

        <record id="view_ticket_form" model="ir.ui.view">
            <field name="name">custom.helpdesk.ticket.form</field>
            <field name="model">custom.helpdesk.ticket</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <field name="stage" widget="statusbar" statusbar_visible="new,open,pending,done"/>
                        <button name="action_set_open" type="object" string="Open" class="btn-primary"
                                invisible="stage not in ['new','pending']"/>
                        <button name="action_set_pending" type="object" string="Pending"
                                invisible="stage == 'pending'"/>
                        <button name="action_set_done" type="object" string="Done" class="btn-primary"
                                invisible="stage == 'done'"/>
                        <button name="action_set_cancelled" type="object" string="Cancel"
                                invisible="stage in ['done','cancelled']"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Ticket Subject..."/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="team_id" options="{'no_create': True}"/>
                                <field name="tenant_id" domain="[('is_company', '=', False)]"
                                       options="{'no_create': True}"/>
                                <field name="date_open"/>
                                <field name="date_close"/>
                            </group>
                            <group>
                                <field name="assigned_to"/>
                                <field name="priority" widget="priority"/>
                                <field name="image" widget="image" options="{'preview_image': 'image'}"/>
                            </group>
                        </group>
                        <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                        <notebook>
                            <page string="Description">
                                <field name="description" placeholder="Describe the issue..."/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- TEAM KANBAN -->
        <record id="action_custom_helpdesk_ticket_form" model="ir.actions.act_window">
            <field name="name">New Helpdesk Ticket</field>
            <field name="res_model">custom.helpdesk.ticket</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>

        <record id="action_custom_helpdesk_ticket_list" model="ir.actions.act_window">
            <field name="name">Helpdesk Tickets</field>
            <field name="res_model">custom.helpdesk.ticket</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record id="view_team_kanban" model="ir.ui.view">
            <field name="name">custom.helpdesk.team.kanban</field>
            <field name="model">custom.helpdesk.team</field>
            <field name="arch" type="xml">
                <kanban>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click"
                                 t-att-data-id="record.id.value">

                                <div class="oe_kanban_content">
                                    <h4 class="text-primary">
                                        <field name="name"/>
                                    </h4>

                                    <div class="mt-3">
                                        <button type="object"
                                                name="action_raise_ticket"
                                                class="btn btn-primary btn-sm">
                                            Raise Ticket
                                        </button>

                                        <button type="object"
                                                name="action_view_tickets"
                                                class="btn btn-secondary btn-sm">
                                            View Tickets
                                        </button>
                                    </div>

                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>


        <record id="view_team_form" model="ir.ui.view">
            <field name="name">custom.helpdesk.team.form</field>
            <field name="model">custom.helpdesk.team</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="description"/>
                            <field name="active"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_teams" model="ir.actions.act_window">
            <field name="name">Helpdesk Teams</field>
            <field name="res_model">custom.helpdesk.team</field>
            <field name="view_mode">kanban,form</field>
        </record>

        <record id="action_tags" model="ir.actions.act_window">
            <field name="name">Tags</field>
            <field name="res_model">custom.helpdesk.tag</field>
            <field name="view_mode">list,form</field>
        </record>

        <menuitem id="main_menu_teams" parent="menu_community_management_root" name="Helpdesk Teams"
                   sequence="10"/>

        <menuitem id="menu_teams" parent="main_menu_teams" name="Teams"
                  action="action_teams" sequence="10"/>

        <menuitem id="menu_tags" parent="main_menu_teams" name="Tags"
                  action="action_tags" sequence="30"/>

    </data>
</odoo>
